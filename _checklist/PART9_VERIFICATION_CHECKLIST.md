# 여기 .md 검증단게에서는 sonnet 4.5 model 사용.

# Part 9 검증 체크리스트

> PDF 파싱 → JSON → 웹 렌더링 전체 검증 진행 상황
>
> 최종 업데이트: 2026-01-17 (9.6-9.10 파싱 스크립트 버그 수정)

---

## 전체 진행률

| 항목 | 완료 | 전체 | 진행률 |
|------|------|------|--------|
| Section 검증 | 11 | 40 | 27.5% |
| Critical 이슈 해결 | 6 | 6 | 100% |
| 수식 이미지 | 1 | ? | - |

### 다음 할 일
1. [x] ~~36건 Article 누락 확인~~ → **순서 뒤섞임 문제였음 (해결됨)**
2. [x] ~~파싱 스크립트 개선~~ → **3가지 버그 수정**
3. [x] ~~9.1-9.5 재검증~~ → **수동 샘플 확인 포함, 모두 PASS**
4. [x] ~~9.6-9.10 검증 진행~~ → **시작점 패턴 버그 수정**
5. [ ] 9.11 ~ 9.20 검증 진행
6. [ ] 검증 스크립트 개선 (참조 패턴 제외)

---

## ⚠️ 검증 시 주의사항 (실수 방지)

### 자동 검증만 믿지 말 것!

**2026-01-17 발생한 실수 #1:**
- 자동 검증에서 "OK" 표시됐지만 실제 content가 뒤섞여 있었음
- 원인: 검증 패턴이 **참조 텍스트도 Article로 오인**

**2026-01-17 발생한 실수 #2 (equations 필드 오류):**
- 문제: "PDF 수식이 이미지라서 누락됨"이라는 일반 정보만 보고 3개 수식 모두 누락으로 가정
- 실제: content를 확인해보니 3개 중 2개(`Do`, `S`)는 이미 텍스트로 있었음
- 누락된 건 1개(`xd`)뿐 - 이것만 실제로 이미지였음
- 원인: **실제 content 확인 없이 가정으로 작업**
- 해결: content 직접 확인 후 equations 필드에서 이미 있는 수식 제거

**2026-01-17 발생한 실수 #3 (where 블록 렌더링 오류):**
- 문제: `where` 블록 변수 정의가 여러 줄로 쪼개져 웹에서 이상하게 렌더링
  ```
  Cb = basic snow load roof factor... and
  0.55 for all other roofs,     <- 별도 줄로 렌더링됨
  ```
- 원인: 파싱 스크립트의 `merge_where_block_lines()` 패턴 오류
  - `^\d+\.\d+` 가 `0.55` 같은 소수도 매칭 → Article로 오인 → where 블록 조기 종료
- 해결: 패턴을 `^9\.\d+\.\d+`로 수정 (OBC Article ID만 매칭)

### 필수 수동 확인 사항

```
[ ] 자동 검증 통과 후에도 최소 3개 섹션 수동 확인
[ ] PDF 원본과 JSON content 첫 2문장 비교
[ ] Article 참조 텍스트가 뒤섞이지 않았는지 확인
    예: "Articles 9.3.1.6. and 9.3.1.7." ← 이게 별도 블록이 되면 안됨
[ ] 수식 누락 작업 전 content에 이미 있는지 먼저 확인!
    → "이미지라서 누락됨" 가정 X, 실제 content 검색 필수
```

### 검증 패턴 주의

```python
# 잘못된 패턴 (참조도 매칭)
r'\b(9\.\d+\.\d+\.\d+)\.?\s'

# 올바른 패턴 (헤딩만 매칭)
r'\n(9\.\d+\.\d+\.\d+)\.\s+[A-Z]'
```

---

## Section별 검증 상태

### 범례
- [ ] 미검증
- [x] 검증 완료
- [!] 이슈 있음 (하단 기록)

---

### 9.1 ~ 9.10 (구조/안전)

| Section | Title | 파싱 | Content | 수식 | 테이블 | 웹 | 비고 |
|---------|-------|------|---------|------|--------|-----|------|
| 9.1 | General | [x] | [x] | N/A | [x] | [x] | 2814자, **FINAL PASS** |
| 9.2 | Definitions | [x] | [x] | N/A | N/A | [x] | 107자, **FINAL PASS** |
| 9.3 | Materials, Systems | [x] | [x] | N/A | [x] | [x] | 12661자, **FINAL PASS** |
| 9.4 | Structural Requirements | [x] | [x] | [x] | [x] | [x] | 9030자, equations 필드 추가, **FINAL PASS** |
| 9.5 | Design of Areas | [x] | [x] | N/A | [x] | [x] | 9998자, **FINAL PASS** |
| 9.6 | Glass | [x] | [x] | N/A | [\!] | [ ] | 줄바꿈+문장중간 해결, 테이블 렌더링(나중에) |
| 9.7 | Windows, Doors | [x] | [x] | N/A | [ ] | [x] | 14553자, end_pattern 버그 수정, **FINAL PASS** |
| 9.8 | Stairs, Ramps | [x] | [x] | N/A | [x] | [x] | 33476자, **FINAL PASS** |
| 9.9 | Means of Egress | [x] | [x] | N/A | [ ] | [ ] | 40716자 |
| 9.10 | Fire Protection | [x] | [x] | N/A | [ ] | [ ] | 9.10.20 패턴 수정으로 해결 |

### 9.11 ~ 9.20 (기초/벽체)

| Section | Title | 파싱 | Content | 수식 | 테이블 | 웹 | 비고 |
|---------|-------|------|---------|------|--------|-----|------|
| 9.11 | Sound Transmission | [ ] | [ ] | [ ] | [ ] | [ ] | |
| 9.12 | Excavation | [ ] | [ ] | [ ] | [ ] | [ ] | |
| 9.13 | Dampproofing | [ ] | [ ] | [ ] | [ ] | [ ] | |
| 9.14 | Drainage | [ ] | [ ] | [ ] | [ ] | [ ] | |
| 9.15 | Footings and Foundations | [ ] | [ ] | [ ] | [ ] | [ ] | |
| 9.16 | Floors-on-Ground | [ ] | [ ] | [ ] | [ ] | [ ] | |
| 9.17 | Columns | [ ] | [ ] | [ ] | [ ] | [ ] | |
| 9.18 | Crawl Spaces | [ ] | [ ] | [ ] | [ ] | [ ] | |
| 9.19 | Roof Spaces | [ ] | [ ] | [ ] | [ ] | [ ] | |
| 9.20 | Masonry and ICF Walls | [ ] | [ ] | [ ] | [ ] | [ ] | |

### 9.21 ~ 9.30 (마감/설비)

| Section | Title | 파싱 | Content | 수식 | 테이블 | 웹 | 비고 |
|---------|-------|------|---------|------|--------|-----|------|
| 9.21 | Chimneys and Flues | [ ] | [ ] | [ ] | [ ] | [ ] | |
| 9.22 | Fireplaces | [ ] | [ ] | [ ] | [ ] | [ ] | |
| 9.23 | Wood Frame Construction | [ ] | [ ] | [ ] | [ ] | [ ] | |
| 9.24 | Sheet Steel Stud | [ ] | [ ] | [ ] | [ ] | [ ] | |
| 9.25 | Heat Transfer | [ ] | [ ] | [!] | [ ] | [ ] | RSI 수식 확인 필요 |
| 9.26 | Roofing | [ ] | [ ] | [ ] | [ ] | [ ] | |
| 9.27 | Cladding | [ ] | [ ] | [ ] | [ ] | [ ] | |
| 9.28 | Stucco | [ ] | [ ] | [ ] | [ ] | [ ] | |
| 9.29 | Interior Wall | [ ] | [ ] | [ ] | [ ] | [ ] | |
| 9.30 | Flooring | [ ] | [ ] | [ ] | [ ] | [ ] | |

### 9.31 ~ 9.41 (설비/특수)

| Section | Title | 파싱 | Content | 수식 | 테이블 | 웹 | 비고 |
|---------|-------|------|---------|------|--------|-----|------|
| 9.31 | Plumbing Facilities | [ ] | [ ] | [ ] | [ ] | [ ] | |
| 9.32 | Ventilation | [ ] | [ ] | [ ] | [ ] | [ ] | |
| 9.33 | Heating and AC | [ ] | [ ] | [ ] | [ ] | [ ] | |
| 9.35 | Garages and Carports | [ ] | [ ] | [ ] | [ ] | [ ] | |
| 9.36 | Reserved | [x] | [x] | N/A | N/A | [x] | 빈 섹션 (정상) |
| 9.37 | Cottages | [ ] | [!] | [ ] | [ ] | [ ] | 9.37.2.2~3 누락 확인 필요 |
| 9.38 | Log Construction | [ ] | [ ] | [ ] | [ ] | [ ] | |
| 9.39 | Park Model Trailers | [ ] | [ ] | [ ] | [ ] | [ ] | |
| 9.40 | Reinforced Concrete | [ ] | [ ] | [ ] | [ ] | [ ] | |
| 9.41 | Change of Use | [ ] | [ ] | [ ] | [ ] | [ ] | |

---

## 해결된 이슈 (2026-01-17)

### 파싱 스크립트 버그 수정 3건

| 버그 | 원인 | 해결 |
|------|------|------|
| Article 순서 뒤섞임 | 헤더 참조가 content에 섞임 | `reorder_articles_in_content()` 추가 |
| 9.4.2 내용 잘림 (578자) | 참조 텍스트를 섹션 헤딩으로 오인 | end_pattern을 `\n...+[A-Z]`로 변경 |
| 9.3.1 참조 텍스트 뒤섞임 | reorder 함수가 참조도 매칭 | 패턴을 줄 시작만 매칭하도록 변경 |

### Critical (내용 누락) - 해결됨

| Section | 이슈 | 상태 | 해결 방법 |
|---------|------|------|----------|
| 9.4.2 | 578자 → 3692자 | ✅ 해결 | end_pattern 수정 |
| 9.3.1 | 참조 텍스트 뒤섞임 | ✅ 해결 | reorder 패턴 수정 |
| 9.7.3 | content 짧음 | ✅ 해결 | page-1 시작으로 수정 |
| 9.8.3 | content 짧음 | ✅ 해결 | page-1 시작으로 수정 |

### Warning (확인 필요)

| Section | 이슈 | 상태 |
|---------|------|------|
| 9.25.x | RSI 계산 수식 확인 필요 | 미확인 |
| 9.37.2 | Article 2, 3 누락 가능 | 미확인 |
| 9.6.1 | 하위조항 (a)(i) 줄바꿈 누락 | 해결 |
| 9.6.1.3 | Notes 문장 중간 줄바꿈 | 해결 |
| 9.6.1.3 | Table 렌더링 이슈 (컴포넌트 문제) | 보류 |

---

## Workflow

```
┌─────────────────────────────────────────────────────────────┐
│  1. 자동 검증 스크립트 실행                                   │
│     → Content 길이 체크                                      │
│     → Article 연속성 체크                                    │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│  2. ⚠️ 수동 샘플 확인 (필수!)                                │
│     → 최소 3개 섹션 PDF 원본과 비교                          │
│     → 첫 2문장 정확한지 확인                                 │
│     → 참조 텍스트 뒤섞임 없는지 확인                          │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│  3. 이슈 분류                                                │
│     A. 텍스트 누락 → 파싱 스크립트 수정                       │
│     B. 순서 뒤섞임 → 패턴 확인 (참조 vs 헤딩)                 │
│     C. 수식 누락 → 수동 입력                                 │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│  4. 수정 & 기록                                              │
│     → JSON 수정 또는 파싱 스크립트 수정                       │
│     → 이 체크리스트 업데이트                                  │
│     → CLAUDE.md 실수 기록에 추가                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 핵심 원칙

| 원칙 | 설명 |
|------|------|
| **자동 검증 + 수동 확인** | 자동 검증 OK여도 반드시 샘플 확인 |
| **참조 vs 헤딩 구분** | `\n...[A-Z]` 패턴 사용 |
| **반복 패턴 → 자동화** | 같은 문제 3번 이상 → 스크립트 수정 |
| **모든 수정 기록** | 체크리스트 + CLAUDE.md |

---

## 검증 명령어

```bash
# 1. Content 길이 체크
python scripts_temp/validate_content.py

# 2. 섹션 ID 연속성 체크 (참조도 매칭하므로 주의!)
python scripts_temp/check_section_continuity.py

# 3. 파싱 재실행
cd scripts_temp && python parse_obc_v4.py

# 4. JSON 복사
cp scripts_temp/output/part9.json codevault/public/data/part9.json
```

### 수동 샘플 확인 명령어

```bash
# 특정 섹션 content 확인
python -c "
import json
with open('codevault/public/data/part9.json', 'r', encoding='utf-8') as f:
    data = json.load(f)
for sec in data['sections']:
    if sec['id'] == '9.3':
        for sub in sec['subsections']:
            if sub['id'] == '9.3.1':
                print(sub['content'][:500])
"
```

---

## 관련 문서

- `CLAUDE.md` - 실수 기록 & 해결 방법
- `_report/PDF_PARSING_GUIDE.md` - 파싱 가이드
- `scripts_temp/parse_obc_v4.py` - 파싱 스크립트

## 🔍 PDF vs 웹 피드백

> PDF와 웹 UI 비교하면서 발견한 차이점 기록
> Claude에게: "체크리스트 피드백 확인해줘"

### 미해결

| ID | 섹션 | 문제 | PDF | 웹 |
|----|------|------|-----|-----|
| | | | | |

### 해결됨

| ID | 섹션 | 문제 | 해결 방법 | 날짜 |
|----|------|------|----------|------|
| FB-001 | 9.4.2.2.(5) | 수식 누락 | equations 필드 추가 | 2026-01-17 |
| FB-002 | 9.10.20 | 시작점 패턴 오류 | start_pattern 수정 | 2026-01-17 |
| FB-003 | 9.7.4 | 시작점 패턴 오류 | 동일 수정 | 2026-01-17 |

### 빠른 추가 (복사용)
```
| FB-XXX | 9.x.x | [문제] | [PDF 내용] | [웹 내용] |
```

<!-- FB-002 added 2026-01-17 -->
