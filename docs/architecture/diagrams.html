<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodeVault Architecture Diagrams</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --border: #e2e8f0;
            --accent: #3b82f6;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-secondary);
            color: var(--text-primary);
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        header {
            text-align: center;
            padding: 2rem 0;
            border-bottom: 1px solid var(--border);
            margin-bottom: 2rem;
        }

        header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        header p {
            color: var(--text-secondary);
        }

        nav {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        nav button {
            padding: 0.75rem 1.5rem;
            border: 1px solid var(--border);
            background: var(--bg-primary);
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.2s;
        }

        nav button:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        nav button.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        .diagram-section {
            display: none;
            background: var(--bg-primary);
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }

        .diagram-section.active {
            display: block;
        }

        .diagram-section h2 {
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--accent);
        }

        .diagram-section p {
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
        }

        .mermaid {
            display: flex;
            justify-content: center;
            padding: 1rem;
            background: var(--bg-secondary);
            border-radius: 8px;
            overflow-x: auto;
        }

        .info-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1rem;
            margin-top: 2rem;
        }

        .info-card {
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 1.5rem;
        }

        .info-card h3 {
            font-size: 1rem;
            color: var(--accent);
            margin-bottom: 0.5rem;
        }

        .info-card p {
            font-size: 0.9rem;
            margin: 0;
        }

        footer {
            text-align: center;
            padding: 2rem;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            header h1 {
                font-size: 1.75rem;
            }

            nav {
                gap: 0.5rem;
            }

            nav button {
                padding: 0.5rem 1rem;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>CodeVault Architecture</h1>
            <p>Ontario Building Code Part 9 Search Service - Interactive Architecture Diagrams</p>
        </header>

        <nav>
            <button class="active" data-target="context">System Context</button>
            <button data-target="container">Container</button>
            <button data-target="component">Component</button>
            <button data-target="data-flow">Data Flow</button>
            <button data-target="search-flow">Search Flow</button>
        </nav>

        <!-- System Context -->
        <section id="context" class="diagram-section active">
            <h2>System Context Diagram (C4 Level 1)</h2>
            <p>ì‹œìŠ¤í…œì˜ ì „ì²´ì ì¸ ë§¥ë½ê³¼ ì™¸ë¶€ ì‹œìŠ¤í…œê³¼ì˜ ê´€ê³„ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.</p>

            <div class="mermaid">
flowchart TB
    subgraph External["External Systems"]
        PDF["ğŸ“„ OBC PDF<br/>(Ontario Building Code 2024)"]
    end

    subgraph Users["Users"]
        User["ğŸ‘· Building Professional<br/>(ê±´ì¶•ì‚¬, ì‹œê³µì, ì¸ìŠ¤í™í„°)"]
    end

    subgraph System["CodeVault System"]
        App["ğŸ›ï¸ CodeVault<br/>(Web Application)"]
    end

    User -->|"ê²€ìƒ‰ ë° íƒìƒ‰<br/>(HTTPS)"| App
    PDF -->|"ë°ì´í„° ì¶”ì¶œ<br/>(ë¹Œë“œ íƒ€ì„)"| App

    style App fill:#3b82f6,color:#fff
    style User fill:#10b981,color:#fff
    style PDF fill:#f59e0b,color:#fff
            </div>

            <div class="info-cards">
                <div class="info-card">
                    <h3>ğŸ‘· Building Professional</h3>
                    <p>ê±´ì¶• ì „ë¬¸ê°€, ì„¤ê³„ì, ì‹œê³µì, ì¸ìŠ¤í™í„°ê°€ OBC Part 9 ê·œì •ì„ ê²€ìƒ‰í•˜ê³  ì°¸ì¡°í•©ë‹ˆë‹¤.</p>
                </div>
                <div class="info-card">
                    <h3>ğŸ›ï¸ CodeVault</h3>
                    <p>Next.js 16 ê¸°ë°˜ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ìœ¼ë¡œ Building Codeë¥¼ ê²€ìƒ‰í•˜ê³  íƒìƒ‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                </div>
                <div class="info-card">
                    <h3>ğŸ“„ OBC PDF</h3>
                    <p>Ontario Building Code 2024 ê³µì‹ PDF ë¬¸ì„œë¡œ, ë¹Œë“œ íƒ€ì„ì— Pythonìœ¼ë¡œ íŒŒì‹±ë©ë‹ˆë‹¤.</p>
                </div>
            </div>
        </section>

        <!-- Container Diagram -->
        <section id="container" class="diagram-section">
            <h2>Container Diagram (C4 Level 2)</h2>
            <p>ì‹œìŠ¤í…œì„ êµ¬ì„±í•˜ëŠ” ì»¨í…Œì´ë„ˆ(ë°°í¬ ê°€ëŠ¥í•œ ë‹¨ìœ„)ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.</p>

            <div class="mermaid">
flowchart TB
    subgraph Runtime["Runtime Environment"]
        subgraph NextJS["Next.js Application"]
            Server["ğŸ–¥ï¸ Server<br/>(SSG, Node.js)"]
            Client["ğŸŒ Browser Client<br/>(React Components)"]
        end

        subgraph Data["JSON Data Store"]
            Part9["part9.json<br/>(Full Content)"]
            Index["part9-index.json<br/>(Search Index)"]
            TOC["toc.json<br/>(Navigation)"]
            Tables["part9_tables.json<br/>(HTML Tables)"]
        end
    end

    subgraph BuildTime["Build-time Processing"]
        Parser["ğŸ PDF Parser<br/>(Python + PyMuPDF)"]
        PDF["ğŸ“„ OBC PDF"]
    end

    User["ğŸ‘· User"] -->|"HTTPS"| Client
    Client <-->|"Hydration"| Server
    Server -->|"Static Import"| Data
    Client -->|"Client Search"| Index
    Parser -->|"fitz.open()"| PDF
    Parser -->|"JSON Write"| Data

    style NextJS fill:#000,color:#fff
    style Data fill:#10b981,color:#fff
    style Parser fill:#3b82f6,color:#fff
            </div>

            <div class="info-cards">
                <div class="info-card">
                    <h3>ğŸ–¥ï¸ Next.js Server</h3>
                    <p>ë¹Œë“œ íƒ€ì„ì— ëª¨ë“  í˜ì´ì§€ë¥¼ ì‚¬ì „ ìƒì„± (SSG). Node.js ê¸°ë°˜.</p>
                </div>
                <div class="info-card">
                    <h3>ğŸŒ Browser Client</h3>
                    <p>React 19 ì»´í¬ë„ŒíŠ¸ë¡œ í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ ê²€ìƒ‰ê³¼ ì¸í„°ë™ì…˜ ì²˜ë¦¬.</p>
                </div>
                <div class="info-card">
                    <h3>ğŸ“ JSON Data Store</h3>
                    <p>ì •ì  JSON íŒŒì¼ë¡œ ì €ì¥ëœ Building Code ë°ì´í„° (~3MB).</p>
                </div>
                <div class="info-card">
                    <h3>ğŸ PDF Parser</h3>
                    <p>Python + PyMuPDFë¡œ PDF í…ìŠ¤íŠ¸ë¥¼ ì¶”ì¶œí•˜ê³  êµ¬ì¡°í™”.</p>
                </div>
            </div>
        </section>

        <!-- Component Diagram -->
        <section id="component" class="diagram-section">
            <h2>Component Diagram (C4 Level 3)</h2>
            <p>Next.js ì• í”Œë¦¬ì¼€ì´ì…˜ ë‚´ë¶€ì˜ ì£¼ìš” ì»´í¬ë„ŒíŠ¸ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.</p>

            <div class="mermaid">
flowchart TB
    subgraph Layout["Layout Components"]
        RootLayout["ğŸ“ RootLayout<br/>(layout.tsx)"]
        Header["ğŸ” Header<br/>(Search Bar)"]
        Sidebar["ğŸ“‘ Sidebar<br/>(TOC Navigation)"]
    end

    subgraph Pages["Page Components"]
        HomePage["ğŸ  HomePage<br/>(Section Grid)"]
        SearchPage["ğŸ” SearchPage<br/>(Results List)"]
        CodePage["ğŸ“„ CodePage<br/>([...section])"]
    end

    subgraph Content["Content Components"]
        SectionView["ğŸ“ SectionView<br/>(Content Parser)"]
        EquationRenderer["â— EquationRenderer<br/>(KaTeX)"]
    end

    subgraph Utils["Utilities"]
        SearchUtils["ğŸ”§ search.ts"]
        Types["ğŸ“‹ types.ts"]
    end

    RootLayout --> Header
    RootLayout --> Sidebar
    RootLayout --> Pages

    HomePage --> Layout
    SearchPage --> Layout
    CodePage --> Layout

    CodePage --> SectionView
    SectionView --> EquationRenderer

    SearchPage --> SearchUtils
    SearchUtils --> Types

    style Layout fill:#3b82f6,color:#fff
    style Pages fill:#10b981,color:#fff
    style Content fill:#f59e0b,color:#fff
    style Utils fill:#8b5cf6,color:#fff
            </div>

            <div class="info-cards">
                <div class="info-card">
                    <h3>ğŸ“ RootLayout</h3>
                    <p>ì „ì²´ í˜ì´ì§€ êµ¬ì¡° (Header + Sidebar + Main Content).</p>
                </div>
                <div class="info-card">
                    <h3>ğŸ” Header</h3>
                    <p>ê²€ìƒ‰ë°”ì™€ ë¸Œëœë”©. /searchë¡œ ê²€ìƒ‰ ì¿¼ë¦¬ ì „ë‹¬.</p>
                </div>
                <div class="info-card">
                    <h3>ğŸ“‘ Sidebar</h3>
                    <p>ì¬ê·€ì  TocNodeë¡œ ê³„ì¸µ ëª©ì°¨ í‘œì‹œ.</p>
                </div>
                <div class="info-card">
                    <h3>ğŸ“ SectionView</h3>
                    <p>ì¡°ë¬¸ í…ìŠ¤íŠ¸ë¥¼ êµ¬ì¡°í™”í•˜ì—¬ ë Œë”ë§ (Article, Clause ë“±).</p>
                </div>
            </div>
        </section>

        <!-- Data Flow -->
        <section id="data-flow" class="diagram-section">
            <h2>Data Flow Diagram</h2>
            <p>PDFì—ì„œ ì‚¬ìš©ì í™”ë©´ê¹Œì§€ ë°ì´í„°ê°€ íë¥´ëŠ” ê³¼ì •ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.</p>

            <div class="mermaid">
flowchart LR
    subgraph Source["Data Source"]
        PDF["ğŸ“„ OBC PDF<br/>301880.pdf"]
    end

    subgraph Processing["Data Processing"]
        TOCExtract["get_toc_part9()"]
        TextExtract["extract_page_text()"]
        Structure["build_structure()"]
    end

    subgraph Storage["JSON Storage"]
        Part9JSON["part9.json"]
        IndexJSON["part9-index.json"]
        TOCJSON["toc.json"]
    end

    subgraph Rendering["UI Rendering"]
        CodePage["CodePage"]
        SearchPage["SearchPage"]
        Sidebar["Sidebar"]
    end

    PDF --> TOCExtract
    PDF --> TextExtract
    TOCExtract --> Structure
    TextExtract --> Structure

    Structure --> Part9JSON
    Structure --> IndexJSON
    Structure --> TOCJSON

    Part9JSON --> CodePage
    IndexJSON --> SearchPage
    TOCJSON --> Sidebar

    style Source fill:#f59e0b,color:#fff
    style Processing fill:#3b82f6,color:#fff
    style Storage fill:#10b981,color:#fff
    style Rendering fill:#8b5cf6,color:#fff
            </div>

            <div class="info-cards">
                <div class="info-card">
                    <h3>1ï¸âƒ£ PDF ì¶”ì¶œ</h3>
                    <p>PyMuPDFë¡œ TOCì™€ í…ìŠ¤íŠ¸ ì¶”ì¶œ. í—¤ë”/í‘¸í„° ì œê±°.</p>
                </div>
                <div class="info-card">
                    <h3>2ï¸âƒ£ êµ¬ì¡°í™”</h3>
                    <p>Part â†’ Section â†’ Subsection â†’ Article ê³„ì¸µ êµ¬ì¡° ìƒì„±.</p>
                </div>
                <div class="info-card">
                    <h3>3ï¸âƒ£ JSON ì €ì¥</h3>
                    <p>ìš©ë„ë³„ JSON íŒŒì¼ ìƒì„± (ì½˜í…ì¸ , ì¸ë±ìŠ¤, TOC).</p>
                </div>
                <div class="info-card">
                    <h3>4ï¸âƒ£ UI ë Œë”ë§</h3>
                    <p>ê° í˜ì´ì§€ì—ì„œ í•„ìš”í•œ JSON ë°ì´í„°ë¥¼ ë¡œë“œí•˜ì—¬ í‘œì‹œ.</p>
                </div>
            </div>
        </section>

        <!-- Search Flow -->
        <section id="search-flow" class="diagram-section">
            <h2>Search Flow Sequence</h2>
            <p>ì‚¬ìš©ìê°€ ê²€ìƒ‰ì„ ìˆ˜í–‰í•  ë•Œì˜ ë°ì´í„° íë¦„ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.</p>

            <div class="mermaid">
sequenceDiagram
    participant User as ğŸ‘· User
    participant Header as ğŸ” Header
    participant Router as ğŸ”€ Router
    participant SearchPage as ğŸ“‘ SearchPage
    participant SearchUtils as ğŸ”§ searchCode()
    participant Index as ğŸ“ part9-index.json

    User->>Header: ê²€ìƒ‰ì–´ ì…ë ¥ "concrete"
    Header->>Router: Navigate /search?q=concrete
    Router->>SearchPage: Load page with query
    SearchPage->>Index: Import index data
    SearchPage->>SearchUtils: searchCode(index, "concrete")

    Note over SearchUtils: Score calculation:<br/>ID match: +100<br/>Title match: +30<br/>Content match: +10

    SearchUtils->>SearchPage: Return top 50 results
    SearchPage->>User: Display results with highlights
            </div>

            <div class="info-cards">
                <div class="info-card">
                    <h3>í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ ê²€ìƒ‰</h3>
                    <p>ì„œë²„ ìš”ì²­ ì—†ì´ ë¸Œë¼ìš°ì €ì—ì„œ ì¦‰ì‹œ ê²€ìƒ‰. ì‘ë‹µ ì‹œê°„ < 10ms.</p>
                </div>
                <div class="info-card">
                    <h3>ì ìˆ˜ ê¸°ë°˜ ì •ë ¬</h3>
                    <p>ID ì¼ì¹˜(+100), ì œëª© ì¼ì¹˜(+30), ë‚´ìš© ì¼ì¹˜(+10)ë¡œ ê´€ë ¨ì„± ìˆœìœ„.</p>
                </div>
                <div class="info-card">
                    <h3>useMemo ìµœì í™”</h3>
                    <p>ê²€ìƒ‰ì–´ê°€ ë³€ê²½ë  ë•Œë§Œ ì¬ê³„ì‚°. ë¶ˆí•„ìš”í•œ ë Œë”ë§ ë°©ì§€.</p>
                </div>
            </div>
        </section>

        <footer>
            <p>CodeVault Architecture Documentation | Generated: 2026-01-16</p>
            <p>Built with Mermaid.js for interactive diagrams</p>
        </footer>
    </div>

    <script>
        // Initialize Mermaid
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            securityLevel: 'loose',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            },
            sequence: {
                useMaxWidth: true,
                diagramMarginX: 50,
                diagramMarginY: 10
            }
        });

        // Tab navigation
        document.querySelectorAll('nav button').forEach(button => {
            button.addEventListener('click', () => {
                // Update active button
                document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
                button.classList.add('active');

                // Update active section
                document.querySelectorAll('.diagram-section').forEach(s => s.classList.remove('active'));
                document.getElementById(button.dataset.target).classList.add('active');
            });
        });
    </script>
</body>
</html>
