# Part 9 E2E 오류 리포트

> 검토일: 2026-01-16
> 검토 방법: Playwright E2E 테스트
> 검토 범위: Part 9 전체 섹션

---

## 요약

Part 9 데이터에서 **심각한 PDF 파싱 오류**가 발견되었습니다. 주요 문제는:

1. **테이블 중복** - 같은 테이블이 여러 번 반복됨
2. **테이블 데이터 손상** - 헤더와 셀이 뒤섞이고 단어가 잘림
3. **잘못된 테이블 배치** - 다른 섹션의 테이블이 표시됨
4. **콘텐츠 누락** - Article, 문단 번호가 누락됨
5. **문장 파편화** - 문장이 중간에 끊겨서 별도 paragraph로 분리됨

---

## 심각도별 분류

### 🔴 Critical (데이터 무결성 훼손)

#### 1. 잘못된 테이블 배치
- **위치**: 9.4.3 Deflections
- **문제**: Table 9.4.3.1 (Deflections) 대신 **Table 9.4.4.1 (Allowable Bearing Pressure for Soil or Rock)**이 표시됨
- **영향**: 완전히 다른 정보가 표시됨

#### 2. 테이블 대량 중복
- **위치**: 9.6.1 Glass
- **문제**: Table 9.6.1.3이 **7번 중복**되어 표시됨
- **영향**: 페이지가 불필요하게 길어지고 혼란 유발

- **위치**: 9.15.4 Foundation Walls
- **문제**: Table 9.15.4.5가 **6번 중복**, Table 9.15.4.2가 **4번 중복**되어 표시됨

- **위치**: 9.23.3 Fasteners and Connectors
- **문제**: Table 9.23.3.5가 **3번 중복**되어 표시됨

#### 3. 테이블 데이터 완전 손상
- **위치**: 9.6.1, 9.23.3, 9.23.4, 9.15.3
- **증상**:
  - 헤더에 데이터 값 혼입: `"1.50 1.50 1.50 1.50 Table 9.6.1.3.-G:"`
  - 단어 잘림/분산:
    - `"Prote"` / `"ction o"` / `"f Glass"`
    - `"Forming P"` / `"art of Sentenc"` / `"e 9.23.3.5.(3)"`
    - `"Min"` / `"imum Length o"` / `"mm"` / `"f Fasteners,"`
    - `"Supported Roof Len"` / `"gth, m(1) 2.4"` (9.23.4)
  - 테이블 제목 누락 (A, B, C, D, E, F 구분 없음)
  - 테이블 Notes가 데이터 셀에 혼입: `"Notes to Table 9.23.4.3-J:"` (9.23.4)

- **위치**: 9.15.3 Footings
- **문제**: Table 9.15.3.4 헤더 완전 손상
- **증상**:
  - 헤더 깨짐: `"Flat wall insulating concrete for rete Form (ICF) Units – Materi t Wall Insulating"`
  - 다른 섹션 내용 혼입: 9.15.4.2 (Foundation Wall Thickness) 내용이 테이블에 포함됨
  - 행/열 구조 완전 붕괴

#### 4. Article 누락/병합
- **위치**: 9.23.3 Fasteners and Connectors
- **문제**: 9.23.3.2, 9.23.3.3, 9.23.3.4가 누락됨 (9.23.3.1 → 9.23.3.5로 점프)

- **위치**: 9.15.3 Footings
- **문제**:
  - 9.15.3.5 제목 누락 (내용만 존재)
  - 9.15.3.9가 이전 문장에 병합됨: `"...beyond the supported element. 9.15.3.9. Step Footings"`

---

### 🟠 High (콘텐츠 일부 손상)

#### 1. 문장 끊김
- **위치**: 9.1.1.8 Building in Flood Plains
- **문제**: 문장이 중간에 끊겨서 `"flooding."` 이 별도 paragraph로 분리됨

- **위치**: 9.3.1.1.(4)
- **문제**: `"(See also Articles 9.15.4.5. and"` 에서 끝남 (나머지 누락)

- **위치**: 9.6.1
- **문제**: `"spaced at 12.7 mm"` 후에 `"."` 가 별도 paragraph

#### 2. Revision Marker 파싱 오류
- **위치**: 9.1.1.9
- **문제**: `"r1 (1)"` - revision marker가 문장 앞에 잘못 포함됨

- **위치**: 9.6.1.2.(2)
- **문제**: `"e2 (2)"` - revision marker가 잘못 포함됨

- **위치**: 9.10.9.4.(2), 9.10.9.16.(4), 9.10.9.17.(4)
- **문제**: `"e2 (2)"`, `"e1 (4)"` 등 revision marker가 잘못 포함됨

#### 3. 제목 분리
- **위치**: 9.10.9 Fire Separations
- **문제**: 제목이 두 줄로 분리됨
  - `"9.10.9.Fire Separations and Smoke-tight Barriers between Rooms"`
  - `"and Spaces within Buildings"` (별도 paragraph)

#### 4. 문단 번호 누락
- **위치**: 9.23.3
- **문제**: (1) 다음에 (6)으로 점프 ((2), (3), (4), (5) 누락)

---

### 🟡 Medium (표시 오류)

#### 1. 테이블 제목/노트 누락
- **위치**: 9.3.1 Concrete
- **문제**: Table 9.3.1.7 제목 누락 ("Site-Batched Concrete Mixes...")
- **문제**: "Notes to Table 9.3.1.7" 누락

---

## 근본 원인 분석

### PDF 파싱 문제

1. **텍스트 블록 순서 문제**
   - PDF 내부 텍스트 블록 순서 ≠ 시각적 순서
   - 이미 CLAUDE.md에 기록된 문제

2. **테이블 파싱 실패**
   - PDF 테이블의 열/행 구조를 올바르게 인식하지 못함
   - 여러 페이지에 걸친 테이블 처리 실패
   - 테이블 경계 감지 실패로 중복 생성

3. **섹션 경계 분리 실패**
   - 이미 CLAUDE.md에 기록된 문제
   - 페이지 단순 연결로 인한 섹션 내용 혼합

---

## 권장 해결 방안

### 단기 (Workaround)

1. **테이블 별도 처리**
   - 테이블이 많은 섹션 (9.4, 9.6, 9.23 등)은 수동 검수
   - 중복 테이블 제거

2. **revision marker 정리**
   - `r1`, `e2` 등의 패턴 제거 또는 별도 표시

### 중기 (파싱 개선)

1. **테이블 파싱 라이브러리 교체**
   - `pdfplumber` 또는 `camelot` 사용 고려
   - 테이블 구조 인식 개선

2. **페이지 경계 처리 개선**
   - 테이블이 여러 페이지에 걸쳐있는 경우 감지
   - 연속 테이블 병합 로직 추가

3. **중복 테이블 감지**
   - 테이블 해시 비교로 중복 제거

### 장기 (데이터 품질)

1. **섹션별 검증 테스트**
   - 각 섹션의 Article 수 검증
   - 테이블 수 검증

2. **원본 PDF 대조**
   - 자동화된 품질 검증 파이프라인

---

## 검토된 섹션

| 섹션 | 상태 | 주요 문제 |
|------|------|----------|
| 9.1.1 | ✅ | ~~문장 끊김, revision marker~~ → v10 수정됨 |
| 9.2.1 | ✅ | 정상 |
| 9.3.1 | ✅ | ~~문장 끊김~~ 수정됨, ~~Table 9.3.1.7 Notes 누락~~ → Notes 추가됨 |
| 9.4.3 | ✅ | ~~잘못된 테이블 배치~~ → 올바른 Table 9.4.3.1 표시 (v10) |
| 9.6.1 | ✅ | ~~테이블 7번 중복~~ → A-G 전체 추출됨 (v10, 135 tables) |
| 9.7.3 | ✅ | 정상 |
| 9.8.1 | ✅ | 정상 (테이블 없음) |
| 9.8.2 | ✅ | 정상 (테이블 없음) |
| 9.10.9 | ✅ | ~~제목 분리, revision marker~~ → v10 수정됨 |
| 9.10.14 | ✅ | 정상 |
| 9.15.3 | ✅ | ~~Article 제목 누락/병합~~ → Articles 1-9 완전, Table 9.15.3.4 정상 |
| 9.15.4 | ✅ | ~~테이블 6번/4번 중복~~ → 중복 제거됨 (v10) |
| 9.20.6 | ✅ | 정상 |
| 9.23.3 | ✅ | ~~Article 누락~~ → 원래 Article 5개만 존재 (OBC 구조), Tables 정상 |
| 9.23.4 | ✅ | ~~추가 검증 필요~~ → Articles 1-5 완전, 23개 Tables 정상 |
| 9.25.2 | ✅ | ~~문장 파편화~~ → v10 수정됨 |

---

## 다음 단계

1. [x] 전체 섹션 스크린샷 캡처 및 원본 PDF 대조 (capture_screenshots.py 스크립트 구현)
2. [x] 테이블 파싱 스크립트 재작성 (extract_tables_v10.py)
3. [x] 중복 테이블 제거 (해시 기반 중복 방지)
4. [x] 섹션별 자동 검증 테스트 구현 (validate_part9.py - 16/16 통과)

---

## 검증 로그

### 2026-01-16 E2E 검증

**9.6.1 Glass 재검증:**
- 상태: 🔴 **문제 지속**
- Table 9.6.1.3이 여전히 **7번 중복** 표시됨
- 테이블 헤더 손상: `"1.50 1.50 1.50 1.50 Table 9.6.1.3.-G:"`
- 단어 분리 문제: `"Prote ction o f Glass"`

**원인 분석:**
- `part9_tables.json` 원본 데이터 자체에 중복 존재
- `fix_table_duplicates.py`는 `part9_tables_v9.json`(배열) 대상
- `part9_tables.json`은 객체 형태로 다른 구조
- 두 데이터 형식 불일치로 중복 제거 미적용

**필요한 작업:**
1. `part9_tables.json` (객체) 형식에 맞는 중복 제거 스크립트 작성
2. 또는 테이블 파싱 스크립트 자체를 수정하여 중복 방지

### 2026-01-16 E2E 검증 (수정 후)

**수정 사항:**
- `SectionView.tsx`에 `renderedTables` Set 추가하여 중복 렌더링 방지
- Regex 패턴 수정: trailing dot optional (`\.?`)
- 이미 렌더링된 테이블 ID는 스킵하고 다음 Article까지 건너뜀

**9.6.1 Glass 검증:**
- 상태: ✅ **중복 문제 해결**
- Table 9.6.1.3.-A ~ F: 각 1회 표시 (Table not found - JSON에 데이터 없음)
- Table 9.6.1.3.-G: 1회만 표시 (정상 렌더링)
- 이전: 같은 테이블이 7번 반복 → 수정 후: 각 테이블 1번씩만 표시

**9.15.4 Foundation Walls 검증:**
- 상태: ✅ **중복 문제 해결**
- Table 9.15.4.2.-A: 1회 표시 (정상 렌더링)
- Table 9.15.4.2.-B: 1회 표시 (정상 렌더링)
- Table 9.15.4.5.-A~C: 각 1회 표시 (Table not found - JSON에 데이터 없음)
- 이전: Table 9.15.4.5가 6번 중복, Table 9.15.4.2가 4번 중복 → 수정 후: 각 1회씩만 표시

**남은 문제 (PDF 파싱 원본 문제):**
- 테이블 A-F 데이터 누락 (`part9_tables.json`에 없음)
- 테이블 헤더 손상: `"1.50 1.50 1.50 1.50 Table 9.6.1.3.-G:"`
- 단어 분리 문제: `"Prote ction o f Glass"`
- 이 문제들은 PDF 파싱 단계에서 해결 필요


### 2026-01-16 v10 테이블 추출 완료

**새로운 스크립트:**
- `extract_tables_v10.py`: bbox 기반 테이블 ID 매칭 (pdfplumber + fitz)
- `fix_part9_content.py`: 본문 후처리 (revision marker 제거, 문장 병합)

**결과:**
- 테이블 수: 92 → 135 (43개 증가)
- 9.6.1 Glass: A-G 전체 7개 테이블 추출 완료
- 9.4.3 Deflections: 올바른 Table 9.4.3.1 표시
- 중복 제거: 해시 기반 중복 감지 적용
- 본문 정리: 48개 subsection의 revision marker 및 파편 문장 수정

**검증 완료:**
- /code/9.6.1: Table 9.6.1.3.-A ~ G 전체 표시 ✅
- /code/9.4.3: Table 9.4.3.1 (Deflections) 올바르게 표시 ✅
- /code/9.15.4: 중복 없이 테이블 표시 ✅

**남은 작업:**
- ~~9.15.3, 9.23.3, 9.23.4 추가 검증 필요~~ → 검증 완료
- 일부 테이블 헤더 구조 개선 필요 (멀티 라인 헤더)
- ~~Table 9.3.1.7 Notes 추가 필요~~ → 추가 완료

### 2026-01-16 데이터 구조 검증 (JSON 분석)

**9.15.3 Footings:**
- 상태: ✅ **완전함**
- Articles 9.15.3.1 ~ 9.15.3.9 모두 존재
- Table 9.15.3.4 정상 추출됨

**9.23.3 Fasteners and Connectors:**
- 상태: ✅ **완전함**
- Articles 9.23.3.1 ~ 9.23.3.5 (OBC 원본 구조 - 5개 Article만 존재)
- Tables 9.23.3.1, 9.23.3.4, 9.23.3.5.-A/B/C 정상 추출됨

**9.23.4 Maximum Spans:**
- 상태: ✅ **완전함**
- Articles 9.23.4.1 ~ 9.23.4.5 모두 존재
- 23개 Tables 정상 추출됨 (9.23.4.2.-A~L, 9.23.4.3.-A~J)

**9.3.1 Concrete:**
- 상태: ✅ **완전함**
- 본문 콘텐츠 완전함 (9.3.1.1 ~ 9.3.1.9)
- Table 9.3.1.7 Notes 추가됨: "(1) 1 part cementing material = 1 × 40 kg bag"

### 2026-01-16 자동 검증 테스트 (validate_part9.py)

**실행 결과: 🎉 16/16 통과**

```
섹션별 검증: 16/16 통과
테이블 Notes 검증: 통과
테이블 중복 검증: 통과
```

**검증 항목:**
- 섹션 콘텐츠 존재 여부
- Article 수 검증 (최소 기준)
- 테이블 존재 여부 (9.3.1, 9.4.3, 9.6.1, 9.15.3, 9.15.4, 9.23.3, 9.23.4)
- 테이블 Notes 검증 (Table 9.3.1.7)
- 테이블 중복 검증 (해시 기반)

**스크립트 위치:** `scripts_temp/validate_part9.py`
